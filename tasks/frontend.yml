---
# tasks file for iptv_analyzer
# - name: Check if curl is installed
#   apt:
#     name: curl
#     state: present
#     update_cache: yes
#   become: true

- name: Get node source script
  get_url:
    url: https://deb.nodesource.com/setup_12.x
    dest: /tmp/node_12_source.sh
    mode: a+x

- name: Execute node source script
  shell: ./node_12_source.sh
  args:
    chdir: /tmp
  become: true

- name: Update apt and install nodejs
  apt:
    name: nodejs
    state: present
    update_cache: yes
  become: true


## TODO Add user, group and clone to seperate user home dir

- name: Clone repo to temp dir
  git:
    repo: "{{ iptv_analyzer_git_repo }}"
    dest: /tmp/iptv_analyzer
    update: yes

- name: Install NodeJS Webfrontend
  npm:
    path: /tmp/iptv_analyzer/nodejs/

- name: Check if config file exist
  stat: path=/tmp/iptv_anlyzer/config.js
  register: frontend_config_stat

- name: Copy config file sample to config
  command: cp /tmp/iptv_anlyzer/config.js.sample /tmp/iptv_anlyzer/config.js
  when: not frontend_config_stat.stat.exists
